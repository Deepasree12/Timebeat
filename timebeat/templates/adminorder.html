{% extends 'adminhome.html' %}

{% block index %}

<form method="POST" action="{% url 'orderstatus' %}">
  {% csrf_token %}
<table class="table table-striped table-bordered table-sm" cellspacing="0" width="100%" id="dataTable">
  <thead>
    <tr>
      <th class="th-sm">Order ID</th>
      <th class="th-sm">User Name</th>
      <th class="th-sm">Address</th>
      <th class="th-sm">Payment Mode</th>
      <th class="th-sm">Created at</th>
      <th class="th-sm">Status</th>
      <th class="th-sm">Mark as Delivered</th>
      
      
      
    </tr>
  </thead>
  <tbody>
    {% for item in orders  %}
    <tr>
      
      <td>{{item.id}}</td>
      <td>{{ item.user.name }}</td>
      <td>{{item.address.address}}</td>
      <td>{{item.payment_mode}}</td>
      <td>{{item.created_at}}</td>
      <td style="color:green;">{{item.status}}</td>
      <td>
        <input type="checkbox" class="order-checkbox" data-order-id="{{ item.id }}"> Delivered
    </tr>
    {% endfor %}
  </tbody>
</table>

</form>
      
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
  // Handle checkbox changes
  $('.order-checkbox').change(function() {
    var orderId = $(this).data('order-id');
    var isChecked = $(this).prop('checked');
    
    // Update the status immediately
    if (isChecked) {
      // Update the UI (optional)
      $(this).closest('tr').find('td:eq(5)').text('Delivered').css('color', 'green');
      
      // Send an AJAX request to update the status in the database
      $.ajax({
        type: 'POST',
        url: '{% url "orderstatus" %}',
        data: {
          csrfmiddlewaretoken: '{{ csrf_token }}',
          order_id: orderId,
          status: 'Delivered'
        },
        success: function(data) {
          // Handle success response (optional)
        },
        error: function(xhr, status, error) {
          // Handle error response (optional)
        }
      });
    }
  });
});
</script>     

{% endblock index %}
